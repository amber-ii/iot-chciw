<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A11儀表</title>
    <link rel="stylesheet" type="text/css" href="./css/index.css">
    <link rel="stylesheet" type="text/css" href="./css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="./css/pattern.css">
    <link rel="icon" href="http://web.chciw.com.tw/iot-chciw/favicon.ico" width="32px" type="image/x-icon">
    <link rel="stylesheet" href="./css/style.css">
</head>

<style>
    body {
        background-color: rgb(17, 24, 39);
    }
    
    .logo-press {
        width: 20px;
        animation: logo-spin infinite 1.5s;
        animation-iteration-count: infinite;
        animation-direction: alternate;
    }
    
    .logo {
        width: 30px;
        animation: logo-spin infinite 1.5s;
        animation-iteration-count: infinite;
        animation-direction: alternate;
    }
    
    @keyframes logo-press-spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
    
    @keyframes logo-spin {
        from {
            transform: rotate(-5deg);
        }
        to {
            transform: rotate(5deg);
        }
    }
    
    .box {
        line-height: 130px;
    }
    
    .content {
        display: inline-flex;
        height: auto;
        vertical-align: middle;
        line-height: 0;
    }
    
    .unit {
        padding-top: 18px;
        color: darkgray;
        font-size: 15px;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
    }
    
    .kgf {
        padding-top: 20px;
        color: darkgray;
        font-size: 8px;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
    }
    
    .mqttvalue {
        color: whitesmoke;
        font-size: 40px;
    }
</style>

<body>
    <div class="max-w-full mx-auto px-20">
        <div class="flex flex-wrap grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 lg:grid-cols-4  md:gap-x-8 2xl:gap-x-12 gap-y-10 gap-x-6 grid-flow-row justify-center pt-12 sm:-m-4 -mx-4 -mb-10 -mt-4 animate__animated animate__fadeIn">

            <!-- 第一個 -->



            <section class="flex justify-center border-b-2 border-r-2 border-gray-400 bg-gray-800 rounded-xl px-6 2xl:px-8 pt-4">
                <div class="w-full">
                    <div class="text-center rounded-lg py-1 tracking-widest text-white font-semibold" style="background-color: navy;">
                        蒸發器出口<span class="px-1 bg-blue-800 rounded-lg">溫度</span>
                    </div>
                    <!-- 數值 icon 單位 -->
                    <div class="flex items-center justify-between">
                        <!-- <ion-icon name="thermometer-outline" class="logo"></ion-icon> -->
                        <img class="logo" src="https://img.icons8.com/color/48/000000/temperature--v1.png" />
                        <div class="box">
                            <div class="content">
                                <div id="ABPLC.A9PLC.PT100_3" class="mqttvalue">00.00</div>
                            </div>
                        </div>
                        <div class="unit">°C</div>
                    </div>
                </div>
            </section>


            <section class="flex justify-center border-b-2 border-r-2 border-gray-400 bg-gray-800 rounded-xl px-6 2xl:px-8 pt-4">
                <div class="w-full">
                    <div class="text-center rounded-lg py-1 tracking-widest text-white font-semibold" style="background-color:crimson ;">
                        除霧器<span class="px-1">1</span>出口<span class="px-1 rounded-lg bg-red-800">溫度</span>
                    </div>

                    <!-- 數值 icon 單位 -->
                    <div class="flex items-center justify-between">
                        <img class="logo" src="https://img.icons8.com/color/48/000000/temperature--v1.png" />
                        <div class="box">
                            <div class="content">
                                <div id="ABPLC.A9PLC.PT100_2" class="mqttvalue">00.00</div>
                            </div>
                        </div>
                        <div class="unit">°C</div>
                    </div>
                </div>
            </section>



            <section class="flex justify-center border-b-2 border-r-2 border-gray-400 bg-gray-800 rounded-xl px-6 2xl:px-8 pt-4">
                <div class="w-full">
                    <div class="text-center rounded-lg py-1 tracking-widest text-white font-semibold" style="background-color: Forestgreen;">
                        除霧器<span class="px-1">2</span>出口<span class="px-1 rounded-lg bg-green-800">溫度</span>
                    </div>
                    <span></span>

                    <div class="flex items-center justify-between">
                        <img class="logo" src="https://img.icons8.com/color/48/000000/temperature--v1.png" />
                        <div class="box">
                            <div class="content">
                                <div id="ABPLC.A9PLC.PT100_1" class="mqttvalue">00.00</div>
                            </div>
                        </div>
                        <div class="unit">°C</div>
                    </div>
            </section>

            <section class="flex justify-center border-b-2 border-r-2 border-gray-400 bg-gray-800 rounded-xl px-6 2xl:px-8 pt-4">
                <div class="w-full">
                    <div class="text-center rounded-lg py-1 tracking-widest text-white font-semibold" style="background-color:orangered;">
                        36%煙酸<span class="px-1 rounded-lg">濃度計</span>
                    </div>

                    <!-- 數值 icon 單位 -->
                    <div class="flex items-center justify-between">
                        <img class="logo" src="https://img.icons8.com/color/48/000000/acid-flask.png" />
                        <div class="box">
                            <div class="content">
                                <div id="ABPLC.A9PLC.A9_36P_ACI_CON" class="mqttvalue">00.00</div>
                            </div>
                        </div>
                        <div class="unit">%</div>
                    </div>
                </div>
            </section>



            <section class="flex justify-center border-b-2 border-r-2 border-gray-400 bg-gray-800 rounded-xl px-6 2xl:px-8 pt-4">
                <div class="w-full">
                    <div class="text-center rounded-lg py-1 tracking-widest text-white font-semibold" style="background-color:navy">
                        A11蒸發器<span class="px-1 bg-blue-800 rounded-lg">壓力</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <img class="logo-press" src="https://img.icons8.com/color/48/000000/water-steam.png" />
                        <div class="box">
                            <div class="content">
                                <div id="ABPLC.A9PLC.A11_EVAPORATOR_PT" class="mqttvalue">00.00</div>
                            </div>
                        </div>
                        <div class="kgf"><sup>kgf</sup><sub>/cm</sub>
                            <sup class="-ml-1">2</sup>
                        </div>
                    </div>
                </div>
            </section>



            <section class="flex justify-center border-b-2 border-r-2 border-gray-400 bg-gray-800 rounded-xl px-6 2xl:px-8 pt-4">
                <div class="w-full">
                    <div class="text-center rounded-lg py-1 tracking-widest text-white font-semibold" style="background-color: crimson;">
                        A11除霧器<span class="px-1">1</span><span class="px-1 rounded-lg bg-red-800">壓力</span>
                    </div>

                    <!-- 數值 icon 單位 -->
                    <div class="flex items-center justify-between">
                        <img class="logo-press" src="https://img.icons8.com/color/48/000000/water-steam.png" />
                        <div class="box">
                            <div class="content">
                                <div id="ABPLC.A9PLC.A11_DP_1_PT" class="mqttvalue">00.00</div>
                            </div>
                        </div>
                        <div class="kgf"><sup>kgf</sup><sub>/cm</sub>
                            <sup class="-ml-1">2</sup>
                        </div>
                    </div>
                </div>
            </section>


            <section class="flex justify-center border-b-2 border-r-2 border-gray-400 bg-gray-800 rounded-xl px-6 2xl:px-8 pt-4">
                <div class="w-full">
                    <div class="text-center rounded-lg py-1 tracking-widest text-white font-semibold" style="background-color: Forestgreen;">
                        A11除霧器<span class="px-1">2</span><span class="px-1 rounded-lg bg-green-800">壓力</span>
                    </div>

                    <!-- 數值 icon 單位 -->
                    <div class="flex items-center justify-between">
                        <img class="logo-press" src="https://img.icons8.com/color/48/000000/water-steam.png" />
                        <div class="box">
                            <div class="content">
                                <div id="ABPLC.A9PLC.A11_DP_2_PT" class="mqttvalue">00.00</div>
                            </div>
                        </div>
                        <div class="kgf"><sup>kgf</sup><sub>/cm</sub>
                            <sup class="-ml-1">2</sup>
                        </div>
                    </div>
                </div>
            </section>


            </div>
        </div>
</body>

<script>
    const fetchData = () => {
        const url = 'http://192.168.1.159:39320/iotgateway/read?ids=ABPLC.A9PLC.A9_36P_ACI_CON&ids=ABPLC.A9PLC.A11_DP_1_PT&ids=ABPLC.A9PLC.A11_DP_2_PT&ids=ABPLC.A9PLC.A11_EVAPORATOR_PT&ids=ABPLC.A9PLC.PT100_1&ids=ABPLC.A9PLC.PT100_2&ids=ABPLC.A9PLC.PT100_3'
        fetch(url, {
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            })
            .then((response) => response.json())
            .then((res) => {
                for (let i = 0; i < res.readResults.length; i++) {
                    if (res.readResults[i].id) {
                        document.getElementById(res.readResults[i].id).innerHTML = roundDecimal(res.readResults[i].v, 3)
                    }
                }
            })
            .catch((err) => console.log('Request Failed', err))
    }

    var roundDecimal = function(val, precision) {
        return Math.round(Math.round(val * Math.pow(10, (precision || 0) + 1)) / 10) / Math.pow(10, (precision || 0));
    }

    setInterval(() => {
        fetchData()
    }, 1000);



    // function onMessageArrived(r_message) {
    //     var rcMsg = JSON.parse(r_message.payloadString);
    //     console.log(rcMsg);
    //     for (var key in rcMsg) {
    //         var id = key;
    //         var value = rcMsg[key];
    //         if (document.getElementById(id)) {
    //             document.getElementById(id).innerHTML = value;
    //         }
    //     }
    // }
</script>

<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
<script type="text/javascript" src="./index.js"></script>
<script type="text/javascript" src="./mqtt.js"></script>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</html>